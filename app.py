import streamlit as st
import gdown
import tempfile
from PIL import Image
from ultralytics import YOLO

# ðŸ”³ Add background image using CSS
st.markdown(
    """
    <style>
    .stApp {
        background-image: url("data:image/jpeg;base64,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");
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
    }
    </style>
    """,
    unsafe_allow_html=True
)

# Google Drive file ID and local model path
FILE_ID = "16p2yZOPplA4BopdyPeJOr2bTWOePc2gQ"
MODEL_PATH = "saif.pt"

@st.cache_resource
def load_model():
    url = f"https://drive.google.com/uc?id={FILE_ID}"
    gdown.download(url, MODEL_PATH, quiet=False)
    model = YOLO(MODEL_PATH)
    return model

try:
    model = load_model()
except Exception as e:
    st.error(f"Failed to load model: {e}")
    st.stop()

st.title("Wildlife Detection with YOLOv5m6u")
uploaded_file = st.file_uploader("Upload an image", type=["jpg", "jpeg", "png"])

if uploaded_file:
    image = Image.open(uploaded_file).convert("RGB")
    st.image(image, caption="Uploaded Image", use_container_width=True)

    with tempfile.NamedTemporaryFile(delete=False, suffix=".jpg") as tmp:
        image.save(tmp.name)
        results = model(tmp.name)

    result_image = results[0].plot()  # returns numpy image with boxes drawn
    st.image(result_image, caption="Detection Result", use_container_width=True)
